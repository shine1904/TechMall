<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ƒêƒÉng nh·∫≠p - TechMall</title>
    <link rel="stylesheet" href="styles.css">
</head>


<body>
    <!-- Header -->
     <header class="header">
    <div class="container header-inner" aria-label="Trang ch·ªß">
      <a class="logo" href="index.html">
        <span class="logo-badge">Tech</span><span class="logo-text">Mall</span>
      </a>

      

      <form class="search-box" action="#" method="get" role="search" aria-label="T√¨m ki·∫øm">
        <input name="q" type="text" placeholder="B·∫°n mu·ªën t√¨m g√¨? (V√≠ d·ª•: iPhone 15, Galaxy S24...)" aria-label="√î t√¨m ki·∫øm">
        <button type="submit" aria-label="T√¨m ki·∫øm">üîç</button>
      </form>

      <nav class="quick-links">
        <a href="#" class="quick-item" aria-label="Tra c·ª©u ƒë∆°n h√†ng">üßæ ƒê∆°n h√†ng</a>
        <a href="cart.html" class="quick-item" aria-label="Gi·ªè h√†ng">üõí Gi·ªè h√†ng</a>
          <a href="login.html" id="btnAccount" class="quick-item" aria-label="T√†i kho·∫£n">üë§ T√†i kho·∫£n</a>

  <!-- Panel hi·ªán khi ƒë√£ ƒëƒÉng nh·∫≠p -->
  <div id="userPanel" class="quick-item" style="display:none;">
  üë§ 
  <a id="userName" href="profile.html" style="text-decoration:none; color:inherit;"></a>
  <button id="btnLogout">ƒêƒÉng xu·∫•t</button>
</div>
</nav>

    <script>
document.addEventListener("DOMContentLoaded", () => {
  const user = JSON.parse(localStorage.getItem("user"));
  const btnAccount = document.getElementById("btnAccount");
  const userPanel = document.getElementById("userPanel");
  const userName = document.getElementById("userName");
  const btnLogout = document.getElementById("btnLogout");

  if (user && user.full_name) {
    // ·∫®n n√∫t ƒëƒÉng nh·∫≠p
    if (btnAccount) btnAccount.style.display = "none";

    // Hi·ªán panel user
    if (userName) userName.textContent = user.full_name;
    if (userPanel) userPanel.style.display = "inline-block";
  } else {
    // N·∫øu kh√¥ng c√≥ user -> hi·ªÉn th·ªã n√∫t ƒëƒÉng nh·∫≠p
    if (btnAccount) btnAccount.style.display = "inline-block";
    if (userPanel) userPanel.style.display = "none";
  }

  // ƒêƒÉng xu·∫•t
  if (btnLogout) {
    btnLogout.addEventListener("click", () => {
      localStorage.clear();
      window.location.href = "login.html";
    });
  }
});
</script>

     
      
    </div>

    <!-- Category bar (desktop) -->
    <div class="category-bar">
      <div class="container cat-inner">
        <a href="showproduct1.html">ƒêi·ªán tho·∫°i</a>
        <a href="showproduct2.html">Laptop</a>
        <a href="showproduct3.html">ƒê·ªìng h·ªì</a>
        <a href="showproduct4.html">Ph·ª• ki·ªán</a>

      </div>
    </div>
  </header>


  <main class="reset-password-page">
  <div class="reset-password-container">
    <h1>ƒê·ªïi m·∫≠t kh·∫©u</h1>
    <form id="resetPasswordForm">
      <input type="password" id="Password" name="Password" placeholder="M·∫≠t kh·∫©u m·ªõi" required>
      <input type="password" id="confirmPassword" name="confirmPassword" placeholder="X√°c nh·∫≠n m·∫≠t kh·∫©u m·ªõi" required>
      <button type="submit" class="btn-primary">C·∫≠p nh·∫≠t</button>
    </form>
  </div>
</main>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const form = document.getElementById("resetPasswordForm");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const password = document.getElementById("Password").value.trim();
    const confirmPassword = document.getElementById("confirmPassword").value.trim();
    
    // L·∫•y token t·ª´ hash fragment thay v√¨ URL parameter
    const token = window.location.hash.substring(1); // B·ªè d·∫•u #

    // Ki·ªÉm tra d·ªØ li·ªáu
    if (!password || !confirmPassword) {
      alert("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin.");
      return;
    }

    if (password !== confirmPassword) {
      alert("M·∫≠t kh·∫©u x√°c nh·∫≠n kh√¥ng kh·ªõp.");
      return;
    }

    if (!token) {
      alert("Token kh√¥ng h·ª£p l·ªá ho·∫∑c ƒë√£ h·∫øt h·∫°n.");
      return;
    }

    // X√≥a token kh·ªèi URL sau khi l·∫•y
    window.history.replaceState({}, document.title, window.location.pathname);

    try {
      // G·ª≠i request l√™n server
      const response = await fetch("http://localhost/ecommerce_api/index.php/api/reset-password", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Accept": "application/json"
        },
        body: JSON.stringify({ token: token, password: password })
      });

      // X·ª≠ l√Ω response nh∆∞ c≈©...
      const raw = await response.text();
      let data;

      try {
        data = JSON.parse(raw);
      } catch {
        console.error("Server kh√¥ng tr·∫£ v·ªÅ JSON:", raw);
        alert("L·ªói server. Vui l√≤ng th·ª≠ l·∫°i sau.");
        return;
      }

      if (response.ok && data.success) {
        alert(data.message || "ƒê·ªïi m·∫≠t kh·∫©u th√†nh c√¥ng!");
        window.location.href = "login.html";
      } else {
        alert(data.message || "ƒê·ªïi m·∫≠t kh·∫©u th·∫•t b·∫°i!");
      }

    } catch (err) {
      console.error("Fetch exception:", err);
      alert("Kh√¥ng th·ªÉ k·∫øt n·ªëi t·ªõi server!");
    }
  });
});
</script>


   <footer>
   <footer class="footer">
    <div class="container footer-grid">
      <div>
        <a class="logo footer-logo" href="#"><span class="logo-badge">Tech</span><span class="logo-text">Mall</span></a>
        <p class="muted">¬© 2025 TechMall. T·∫•t c·∫£ c√°c quy·ªÅn ƒë∆∞·ª£c b·∫£o l∆∞u.</p>
        <p class="muted">Hotline: 1800 0000 (Mi·ªÖn ph√≠)</p>
      </div>
      <div>
        <h4>H·ªó tr·ª£ kh√°ch h√†ng</h4>
        <ul class="footer-list">
          <li><a href="#">Trung t√¢m tr·ª£ gi√∫p</a></li>
          <li><a href="#">H∆∞·ªõng d·∫´n mua h√†ng</a></li>
          <li><a href="#">Ch√≠nh s√°ch b·∫£o h√†nh</a></li>
          <li><a href="#">Ch√≠nh s√°ch ƒë·ªïi tr·∫£</a></li>
        </ul>
      </div>
      <div>
        <h4>V·ªÅ TechMall</h4>
        <ul class="footer-list">
          <li><a href="#">Gi·ªõi thi·ªáu</a></li>
          <li><a href="#">Tuy·ªÉn d·ª•ng</a></li>
          <li><a href="#">H·ªá th·ªëng c·ª≠a h√†ng</a></li>
        </ul>
      </div>
      <div>
        <h4>K·∫øt n·ªëi v·ªõi ch√∫ng t√¥i</h4>
        <div class="socials">
          <a href="#" aria-label="Facebook">üåê</a>
          <a href="#" aria-label="YouTube">‚ñ∂Ô∏è</a>
          <a href="#" aria-label="Zalo">üí¨</a>
        </div>
      </div>
    </div>
  </footer>
    
</body>
</html>
