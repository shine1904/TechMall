<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÄÄƒng nháº­p - TechMall</title>
    <link rel="stylesheet" href="styles.css">
</head>


<body>
    <!-- Header -->
     <header class="header">
    <div class="container header-inner" aria-label="Trang chá»§">
      <a class="logo" href="index.html">
        <span class="logo-badge">Tech</span><span class="logo-text">Mall</span>
      </a>

      

      <form class="search-box" action="#" method="get" role="search" aria-label="TÃ¬m kiáº¿m">
        <input name="q" type="text" placeholder="Báº¡n muá»‘n tÃ¬m gÃ¬? (VÃ­ dá»¥: iPhone 15, Galaxy S24...)" aria-label="Ã” tÃ¬m kiáº¿m">
        <button type="submit" aria-label="TÃ¬m kiáº¿m">ğŸ”</button>
      </form>

      <nav class="quick-links">
        <a href="#" class="quick-item" aria-label="Tra cá»©u Ä‘Æ¡n hÃ ng">ğŸ§¾ ÄÆ¡n hÃ ng</a>
        <a href="cart.html" class="quick-item" aria-label="Giá» hÃ ng">ğŸ›’ Giá» hÃ ng</a>
          <a href="login.html" id="btnAccount" class="quick-item" aria-label="TÃ i khoáº£n">ğŸ‘¤ TÃ i khoáº£n</a>

  <!-- Panel hiá»‡n khi Ä‘Ã£ Ä‘Äƒng nháº­p -->
  <div id="userPanel" class="quick-item" style="display:none;">
  ğŸ‘¤ 
  <a id="userName" href="profile.html" style="text-decoration:none; color:inherit;"></a>
  <button id="btnLogout">ÄÄƒng xuáº¥t</button>
</div>
</nav>

    <script>
document.addEventListener("DOMContentLoaded", () => {
  const user = JSON.parse(localStorage.getItem("user"));
  const btnAccount = document.getElementById("btnAccount");
  const userPanel = document.getElementById("userPanel");
  const userName = document.getElementById("userName");
  const btnLogout = document.getElementById("btnLogout");

  if (user && user.full_name) {
    // áº¨n nÃºt Ä‘Äƒng nháº­p
    if (btnAccount) btnAccount.style.display = "none";

    // Hiá»‡n panel user
    if (userName) userName.textContent = user.full_name;
    if (userPanel) userPanel.style.display = "inline-block";
  } else {
    // Náº¿u khÃ´ng cÃ³ user -> hiá»ƒn thá»‹ nÃºt Ä‘Äƒng nháº­p
    if (btnAccount) btnAccount.style.display = "inline-block";
    if (userPanel) userPanel.style.display = "none";
  }

  // ÄÄƒng xuáº¥t
  if (btnLogout) {
    btnLogout.addEventListener("click", () => {
      localStorage.clear();
      window.location.href = "login.html";
    });
  }
});
</script>

     
      
    </div>

    <!-- Category bar (desktop) -->
    <div class="category-bar">
      <div class="container cat-inner">
        <a href="showproduct1.html">Äiá»‡n thoáº¡i</a>
        <a href="showproduct2.html">Laptop</a>
        <a href="showproduct3.html">Äá»“ng há»“</a>
        <a href="showproduct4.html">Phá»¥ kiá»‡n</a>

      </div>
    </div>
  </header>

 <main class="login-page">
  <div class="login-container">
    <h1>ÄÄƒng nháº­p</h1>
    
    <!-- ThÃ´ng bÃ¡o lá»—i tá»« admin redirect -->
    <div id="authErrorAlert" style="display:none; background:#fee; color:#c33; padding:10px; margin:10px 0; border:1px solid #fcc; border-radius:4px;">
    </div>
    
    <!-- thÃªm id cho form -->
    <form id="loginForm">
      <!-- Ä‘á»•i username thÃ nh email Ä‘á»ƒ khá»›p vá»›i JS vÃ  API -->
      <input type="email" id="email" name="email" placeholder="Email" required>
      <input type="password" id="password" name="password" placeholder="Máº­t kháº©u" required>

      <a href="#" class="forgot" id="forgotBtn">QuÃªn máº­t kháº©u?</a>

      <button type="submit" class="btn-primary">ÄÄƒng nháº­p</button>
      <a href="register.html" class="btn-secondary">ÄÄƒng kÃ½</a>
    </form>
  </div>
</main>
<script>
let inactivityTimer;

// ğŸ•’ Báº¯t Ä‘áº§u Ä‘áº¿m thá»i gian khÃ´ng hoáº¡t Ä‘á»™ng
function startInactivityTimer() {
  clearTimeout(inactivityTimer);
  inactivityTimer = setTimeout(() => {
    alert("Báº¡n Ä‘Ã£ dá»«ng quÃ¡ lÃ¢u (hÆ¡n 1 phÃºt). Vui lÃ²ng nháº­p láº¡i Ä‘á»ƒ Ä‘Äƒng nháº­p.");
  }, 60000); // 1 phÃºt
}

// Reset timer má»—i khi ngÆ°á»i dÃ¹ng gÃµ
document.getElementById("email").addEventListener("input", startInactivityTimer);
document.getElementById("password").addEventListener("input", startInactivityTimer);

// ğŸ” Hiá»ƒn thá»‹ thÃ´ng bÃ¡o lá»—i admin redirect náº¿u cÃ³
document.addEventListener('DOMContentLoaded', () => {
  const authError = sessionStorage.getItem('authError');
  if (authError) {
    const alertEl = document.getElementById('authErrorAlert');
    if (alertEl) {
      alertEl.textContent = authError;
      alertEl.style.display = 'block';
    }
    // XÃ³a thÃ´ng bÃ¡o sau khi hiá»ƒn thá»‹
    sessionStorage.removeItem('authError');
  }
});

// Báº¯t Ä‘áº§u Ä‘áº¿m khi trang load
startInactivityTimer();

// ğŸŸ¢ Xá»­ lÃ½ ÄÄƒng nháº­p
document.getElementById("loginForm").addEventListener("submit", async function (e) {
  e.preventDefault();

  const email = document.getElementById("email").value.trim();
  const password = document.getElementById("password").value.trim();
  const url = "http://localhost/ecommerce_api/index.php/api/login";

  try {
    const res = await fetch(url, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Accept": "application/json"
      },
      body: JSON.stringify({ email, password })
    });

    const raw = await res.text();
    let data;
    try {
      data = JSON.parse(raw);
    } catch {
      console.error("Server khÃ´ng tráº£ vá» JSON:", raw);
      alert("Lá»—i server: dá»¯ liá»‡u khÃ´ng há»£p lá»‡.");
      return;
    }

    if (res.ok && data.success && data.data?.token) {
      // LÆ°u token
      localStorage.setItem("token", data.data.token);

      // LÆ°u user
      if (data.data.user) {
        localStorage.setItem("user", JSON.stringify(data.data.user));
        localStorage.setItem("user_id", data.data.user.id);
      }

      alert(data.message || "ÄÄƒng nháº­p thÃ nh cÃ´ng!");
      window.location.href = "index.html";
    } else {
      // Náº¿u backend bÃ¡o bá»‹ khÃ³a
      if (res.status === 403 && data.message?.toLowerCase().includes("locked")) {
        alert(data.message);
      } else {
        alert(data.message || `Lá»—i server (${res.status})`);
      }
    }
  } catch (err) {
    console.error("Fetch exception:", err);
    alert("KhÃ´ng thá»ƒ káº¿t ná»‘i tá»›i server!");
  } finally {
    // Sau má»—i láº§n submit, khá»Ÿi Ä‘á»™ng láº¡i timer
    startInactivityTimer();
  }
});

// ğŸ”µ Xá»­ lÃ½ QuÃªn máº­t kháº©u
document.getElementById("forgotBtn").addEventListener("click", async function (e) {
  e.preventDefault();

  const email = document.getElementById("email").value.trim();
  if (!email) {
    alert("Vui lÃ²ng nháº­p email trÆ°á»›c khi yÃªu cáº§u quÃªn máº­t kháº©u!");
    return;
  }

  const url = "http://localhost/ecommerce_api/index.php/api/forgot-password";

  try {
    const res = await fetch(url, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Accept": "application/json"
      },
      body: JSON.stringify({ email })
    });

    const raw = await res.text();
    let data;
    try {
      data = JSON.parse(raw);
    } catch {
      console.error("Server khÃ´ng tráº£ vá» JSON:", raw);
      alert("Lá»—i server: dá»¯ liá»‡u khÃ´ng há»£p lá»‡.");
      return;
    }

    if (res.ok && data.success) {
      alert(data.message || "Má»™t email Ä‘áº·t láº¡i máº­t kháº©u Ä‘Ã£ Ä‘Æ°á»£c gá»­i!");
    } else {
      alert(data.message || `Lá»—i server (${res.status})`);
    }
  } catch (err) {
    console.error("Fetch exception:", err);
    alert("KhÃ´ng thá»ƒ káº¿t ná»‘i tá»›i server!");
  }
});
</script>









    <!-- Footer -->
    
       <footer>
   <footer class="footer">
    <div class="container footer-grid">
      <div>
        <a class="logo footer-logo" href="#"><span class="logo-badge">Tech</span><span class="logo-text">Mall</span></a>
        <p class="muted">Â© 2025 TechMall. Táº¥t cáº£ cÃ¡c quyá»n Ä‘Æ°á»£c báº£o lÆ°u.</p>
        <p class="muted">Hotline: 1800 0000 (Miá»…n phÃ­)</p>
      </div>
      <div>
        <h4>Há»— trá»£ khÃ¡ch hÃ ng</h4>
        <ul class="footer-list">
          <li><a href="#">Trung tÃ¢m trá»£ giÃºp</a></li>
          <li><a href="#">HÆ°á»›ng dáº«n mua hÃ ng</a></li>
          <li><a href="#">ChÃ­nh sÃ¡ch báº£o hÃ nh</a></li>
          <li><a href="#">ChÃ­nh sÃ¡ch Ä‘á»•i tráº£</a></li>
        </ul>
      </div>
      <div>
        <h4>Vá» TechMall</h4>
        <ul class="footer-list">
          <li><a href="#">Giá»›i thiá»‡u</a></li>
          <li><a href="#">Tuyá»ƒn dá»¥ng</a></li>
          <li><a href="#">Há»‡ thá»‘ng cá»­a hÃ ng</a></li>
        </ul>
      </div>
      <div>
        <h4>Káº¿t ná»‘i vá»›i chÃºng tÃ´i</h4>
        <div class="socials">
          <a href="#" aria-label="Facebook">ğŸŒ</a>
          <a href="#" aria-label="YouTube">â–¶ï¸</a>
          <a href="#" aria-label="Zalo">ğŸ’¬</a>
        </div>
      </div>
    </div>
  </footer>
    
</body>
</html>
