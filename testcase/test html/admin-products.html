<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Qu·∫£n tr·ªã s·∫£n ph·∫©m - TechMall</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body class="admin-page">
  <!-- Admin Header -->
  <header class="admin-header">
    <div class="admin-header-inner">
      <a class="admin-brand" href="index.html">
        <span class="logo-badge">Tech</span><span class="logo-text">Mall Admin</span>
      </a>
      <nav class="admin-nav">
        <a href="admin-products.html" data-nav="products">S·∫£n ph·∫©m</a>
        <a href="admin-users.html" data-nav="users">Ng∆∞·ªùi d√πng</a>
        <a href="index.html">Trang b√°n h√†ng</a>
      </nav>
      <div class="admin-user">
        <span id="adminUserName" class="muted"></span>
        <button class="btn" id="btnLogout">ƒêƒÉng xu·∫•t</button>
      </div>
    </div>
  </header>
  <script>
    (function adminHeaderInit(){
      const u = (()=>{ try{return JSON.parse(localStorage.getItem('user')||'null')}catch{return null} })();
      const nameEl = document.getElementById('adminUserName');
      if(nameEl) nameEl.textContent = (u && u.full_name) ? u.full_name : 'Kh√°ch';
      const btnLogout = document.getElementById('btnLogout');
      if(btnLogout){ btnLogout.addEventListener('click', ()=>{ localStorage.clear(); window.location.href = 'login.html'; }); }
      
      // Ki·ªÉm tra quy·ªÅn ƒë·ªÉ thao t√°c v·ªõi nut ƒëi·ªÅu h∆∞·ªõng
      let roles = (u && u.roles) || [];
      if (typeof roles === "string") {
        roles = [roles];
      }
      
      const isProductAdminOnly = roles.includes('product_admin') && 
                                !roles.includes('super_admin') && 
                                !roles.includes('user.read') &&
                                !roles.includes('user.role.manage');
      
      const userNavBtn = document.querySelector('.admin-nav a[data-nav="users"]');
      if (userNavBtn && isProductAdminOnly) {
        userNavBtn.style.display = 'none';
      }
      
      const path = (location.pathname||'').toLowerCase();
      document.querySelectorAll('.admin-nav a[data-nav]').forEach(a=>{
        const key=a.getAttribute('data-nav');
        if((key==='products' && path.endsWith('admin-products.html')) || 
           (key==='users' && path.endsWith('admin-users.html')) ||
           (key==='orders' && path.endsWith('admin-orders.html'))){ 
          a.classList.add('active'); 
        }
      });
    })();
  </script>
  <div class="admin-wrap">
    <h1 class="page-title">Qu·∫£n tr·ªã s·∫£n ph·∫©m</h1>
    
    <!-- Search and Actions Bar -->
    <div class="bar-top">
      <div class="left toolbar">
        <input id="txtSearch" placeholder="T√¨m theo t√™n/m√¥ t·∫£..." style="min-width: 250px;">
        <select id="selCategory">
          <option value="">T·∫•t c·∫£ danh m·ª•c</option>
        </select>
        <button class="btn primary" id="btnSearch">T√¨m</button>
        <button class="btn" id="btnClear">X√≥a t√¨m</button>
      </div>
      <div class="right toolbar">
        <small id="noticeAuth" class="muted" style="display:none">Y√™u c·∫ßu ƒëƒÉng nh·∫≠p ƒë·ªÉ th√™m/s·ª≠a/x√≥a</small>
        <button class="btn primary" id="btnCreate">+ Th√™m s·∫£n ph·∫©m</button>
      </div>
    </div>

    <!-- Products Table -->
    <table class="admin-table" id="tblProducts">
      <thead>
        <tr>
          <th>ID</th>
          <th>·∫¢nh</th>
          <th>T√™n s·∫£n ph·∫©m</th>
          <th>Th∆∞∆°ng hi·ªáu</th>
          <th>Gi√°</th>
          <th>T·ªìn kho</th>
          <th>H√†nh ƒë·ªông</th>
        </tr>
      </thead>
      <tbody>
        <tr><td colspan="8" class="empty">ƒêang t·∫£i d·ªØ li·ªáu...</td></tr>
      </tbody>
    </table>

    <!-- Pagination -->
    <div class="pagination">
      <button class="btn" id="btnPrev">Trang tr∆∞·ªõc</button>
      <span class="page-info" id="pageLabel">Trang 1</span>
      <button class="btn" id="btnNext">Trang sau</button>
    </div>
  </div>

  <!-- Product Create/Edit Dialog -->
  <dialog id="dlgProduct" class="products-dialog">
    <form method="dialog" class="dlg" id="frmProduct">
      <h3 id="dlgTitle">Th√™m s·∫£n ph·∫©m m·ªõi</h3>
      <input type="hidden" id="prdId">
      
      <div class="form-grid">
        <div class="form-group">
          <label for="prdName">T√™n s·∫£n ph·∫©m *</label>
          <input id="prdName" required placeholder="Nh·∫≠p t√™n s·∫£n ph·∫©m">
        </div>
        <div class="form-group">
          <label for="prdCategory">Danh m·ª•c *</label>
          <select id="prdCategory" required>
            <option value="">Ch·ªçn danh m·ª•c</option>
          </select>
        </div>
        <div class="form-group">
          <label for="prdType">Th∆∞∆°ng hi·ªáu</label>
          <input id="prdType" placeholder="VD: Samsung, Apple, Xiaomi...">
        </div>
        <div class="form-group">
          <label for="prdPrice">Gi√° b√°n (‚Ç´) *</label>
          <input id="prdPrice" type="number" min="0" step="1000" required placeholder="0">
        </div>
        <div class="form-group">
          <label for="prdStock">S·ªë l∆∞·ª£ng t·ªìn kho *</label>
          <input id="prdStock" type="number" min="0" step="1" required placeholder="0">
        </div>
        <div class="form-group">
          <label for="prdThumb">·∫¢nh s·∫£n ph·∫©m (URL ho·∫∑c JSON)</label>
          <input id="prdThumb" placeholder='VD: "image1.jpg" ho·∫∑c ["img1.jpg","img2.jpg"]'>
        </div>
        <div class="form-group full">
          <label for="prdDesc">M√¥ t·∫£ chi ti·∫øt</label>
          <textarea id="prdDesc" rows="4" placeholder="RAM: 8GB, ROM: 256GB, Camera: 108MP, Pin: 5000mAh..."></textarea>
        </div>
      </div>
      
      <div class="dlg-actions">
        <button class="btn" type="button" id="btnCancel">H·ªßy</button>
        <button class="btn primary" id="btnSave" type="submit">L∆∞u s·∫£n ph·∫©m</button>
      </div>
    </form>
  </dialog>

  <script src="js/admin-products.js"></script>
  <!-- Admin Footer -->
   <footer class="footer">
    <div class="container footer-grid">
      <div>
        <a class="logo footer-logo" href="#"><span class="logo-badge">Tech</span><span class="logo-text">Mall</span></a>
        <p class="muted">¬© 2025 TechMall. T·∫•t c·∫£ c√°c quy·ªÅn ƒë∆∞·ª£c b·∫£o l∆∞u.</p>
        <p class="muted">Hotline: 6969 9696 (Mi·ªÖn ph√≠)</p>
      </div>
      <div>
        <h4>H·ªó tr·ª£ kh√°ch h√†ng</h4>
        <ul class="footer-list">
          <li><a href="#">Trung t√¢m tr·ª£ gi√∫p</a></li>
          <li><a href="#">H∆∞·ªõng d·∫´n mua h√†ng</a></li>
          <li><a href="#">Ch√≠nh s√°ch b·∫£o h√†nh</a></li>
          <li><a href="#">Ch√≠nh s√°ch ƒë·ªïi tr·∫£</a></li>
        </ul>
      </div>
      <div>
        <h4>V·ªÅ TechMall</h4>
        <ul class="footer-list">
          <li><a href="#">Gi·ªõi thi·ªáu</a></li>
          <li><a href="#">Tuy·ªÉn d·ª•ng</a></li>
          <li><a href="#">H·ªá th·ªëng c·ª≠a h√†ng</a></li>
        </ul>
      </div>
      <div>
        <h4>K·∫øt n·ªëi v·ªõi ch√∫ng t√¥i</h4>
        <div class="socials">
          <a href="#" aria-label="Facebook">üåê</a>
          <a href="#" aria-label="YouTube">‚ñ∂Ô∏è</a>
          <a href="#" aria-label="Zalo">üí¨</a>
        </div>
      </div>
    </div>
  </footer>
  
  <!-- Admin Authentication Guard - PH·∫¢I load tr∆∞·ªõc admin-products.js -->
  <script src="js/admin-auth.js"></script>
  <!-- Admin Products Script -->
  <script src="js/admin-products.js"></script>
</body>
</html>
