<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TechMall - Mua s·∫Øm ƒëi·ªán tho·∫°i, laptop, ph·ª• ki·ªán</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css" />
  <link rel="icon" href="data:;base64,iVBORw0KGgo=" />
</head>
<body>
  <!-- Top Notification -->
  <div class="topbar">
    <div class="container">
      <span>‚ö° Gi·∫£m ƒë·∫øn 50% | Freeship ƒë∆°n t·ª´ 500k | Tr·∫£ g√≥p 0%</span>
    </div>
  </div>

  <!-- Header -->
  <header class="header">
    <div class="container header-inner">
      <a class="logo" href="index.html">
        <span class="logo-badge">Tech</span><span class="logo-text">Mall</span>
      </a>
      <script>
        const API_BASE = "http://localhost/ecommerce_api/index.php/api";
      
        // ‚úÖ T·∫°o placeholder image SVG th·ªëng nh·∫•t
        function createPlaceholderImage(width = 150, height = 150, text = "No Image") {
          const svg = `<svg width="${width}" height="${height}" xmlns="http://www.w3.org/2000/svg">
            <rect width="${width}" height="${height}" fill="#f8f9fa"/>
            <text x="${width/2}" y="${height/2}" text-anchor="middle" dy=".3em" font-family="Arial" font-size="14" fill="#6c757d">${text}</text>
          </svg>`;
          return `data:image/svg+xml;base64,${btoa(svg)}`;
        }
      
        // X·ª≠ l√Ω form search
        document.addEventListener("DOMContentLoaded", () => {
          const searchForm = document.querySelector(".search-box");
          const searchInput = searchForm.querySelector("input[name='q']");
      
          searchForm.addEventListener("submit", async (e) => {
            e.preventDefault();
            const keyword = searchInput.value.trim();
            if (!keyword) return;
      
            try {
              const res = await fetch(`${API_BASE}/products/search?q=${encodeURIComponent(keyword)}`);
              const data = await res.json();
      
              // X√≥a grid c≈©
              const grids = document.querySelectorAll(".product-grid");
              grids.forEach(grid => grid.innerHTML = "");
      
              if (data.success && data.data.length > 0) {
                renderSearchResults(data.data);
              } else {
                const firstSection = document.querySelector(".section");
                if (firstSection) {
                  firstSection.innerHTML = `<p style="padding:20px; color:#666;">Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m n√†o cho t·ª´ kh√≥a "<strong>${keyword}</strong>"</p>`;
                }
              }
            } catch (err) {
              console.error("Search error:", err);
              alert("L·ªói khi t√¨m ki·∫øm s·∫£n ph·∫©m!");
            }
          });
        });
      
        // H√†m render k·∫øt qu·∫£ search (d√πng l·∫°i template card gi·ªëng fetchProducts)
        function renderSearchResults(products) {
        let section = document.querySelector("#search-results-section");
        if (!section) {
          section = document.createElement("section");
          section.className = "section";
          section.id = "search-results-section";
          document.querySelector(".hero").insertAdjacentElement("afterend", section);
        }
      
        section.innerHTML = `
          <div class="container section-head">
            <h2>K·∫øt qu·∫£ t√¨m ki·∫øm</h2>
            <div class="filter-bar">
              <label for="categoryFilter">L·ªçc theo danh m·ª•c: </label>
              <select id="categoryFilter">
                <option value="">T·∫•t c·∫£</option>
                <option value="1">ƒêi·ªán tho·∫°i</option>
                <option value="2">Laptop</option>
                <option value="3">Tablet</option>
                <option value="4">Ph·ª• ki·ªán ƒëi·ªán tho·∫°i</option>
                <option value="5">Ph·ª• ki·ªán laptop</option>
                <option value="6">√Çm thanh</option>
                <option value="7">ƒê·ªìng h·ªì th√¥ng minh</option>
              </select>
            </div>
          </div>
          <div id="search-grid" class="container product-grid"></div>
        `;
      
        const filterSelect = section.querySelector("#categoryFilter");
      
        // Hi·ªÉn th·ªã t·∫•t c·∫£ ban ƒë·∫ßu
        renderProducts(products, "search-grid");
      
        // Khi ch·ªçn filter category
        filterSelect.addEventListener("change", () => {
          const cat = filterSelect.value;
          if (!cat) {
            renderProducts(products, "search-grid");
          } else {
            const filtered = products.filter(p => String(p.category_id) === cat);
            renderProducts(filtered, "search-grid");
          }
        });
      }
      </script>

      

      <form class="search-box" action="#" method="get" role="search" aria-label="T√¨m ki·∫øm">
        <input name="q" type="text" placeholder="B·∫°n mu·ªën t√¨m g√¨? (V√≠ d·ª•: iPhone 15, Galaxy S24...)" aria-label="√î t√¨m ki·∫øm">
        <button type="submit" aria-label="T√¨m ki·∫øm">üîç</button>
      </form>

    <nav class="quick-links">
  <a href="order.html" class="quick-item" aria-label="Tra c·ª©u ƒë∆°n h√†ng">üßæ ƒê∆°n h√†ng</a>
  <a href="cart.html" class="quick-item" aria-label="Gi·ªè h√†ng">üõí Gi·ªè h√†ng</a>
    <a href="admin-products.html" id="btnAdmin" class="quick-item admin-btn" aria-label="Qu·∫£n tr·ªã" style="display:none;">‚öôÔ∏è Qu·∫£n tr·ªã</a>

  <!-- N√∫t m·∫∑c ƒë·ªãnh khi ch∆∞a ƒëƒÉng nh·∫≠p -->
  <a href="login.html" id="btnAccount" class="quick-item" aria-label="T√†i kho·∫£n">üë§ T√†i kho·∫£n</a>

  <!-- Panel hi·ªán khi ƒë√£ ƒëƒÉng nh·∫≠p -->
  <div id="userPanel" class="quick-item" style="display:none;">
  üë§ 
  <a id="userName" href="profile.html" style="text-decoration:none; color:inherit;"></a>
  <button id="btnLogout">ƒêƒÉng xu·∫•t</button>
</div>
</nav>

   <script>
document.addEventListener("DOMContentLoaded", () => {
  const user = JSON.parse(localStorage.getItem("user"));
  console.log("User object t·ª´ localStorage:", user);

  const btnAccount = document.getElementById("btnAccount");
  const userPanel = document.getElementById("userPanel");
  const userName = document.getElementById("userName");
  const btnLogout = document.getElementById("btnLogout");
  const btnAdmin = document.getElementById("btnAdmin");

  if (user && user.full_name) {
    // ·∫®n n√∫t ƒëƒÉng nh·∫≠p
    if (btnAccount) btnAccount.style.display = "none";

    // Hi·ªán panel user
    if (userName) userName.textContent = user.full_name;
    if (userPanel) userPanel.style.display = "inline-block";

    // ---- X·ª≠ l√Ω roles linh ho·∫°t ----
    let roles = user.roles || [];
    // N·∫øu roles l√† chu·ªói -> bi·∫øn th√†nh m·∫£ng ƒë·ªÉ check
    if (typeof roles === "string") {
      roles = [roles];
    }

    // Ki·ªÉm tra c√°c role admin (bao g·ªìm c·∫£ product_admin)
    const canAccessAdmin = roles.includes("admin") || 
                          roles.includes("super_admin") || 
                          roles.includes("product_admin") ||
                          roles.includes("order_admin") ||
                          roles.includes("content_admin") ||
                          roles.includes("report_admin");

    if (btnAdmin) {
      btnAdmin.style.display = canAccessAdmin ? "inline-block" : "none";
    }
    // ---------------------------------

  } else {
    // N·∫øu kh√¥ng c√≥ user -> hi·ªÉn th·ªã n√∫t ƒëƒÉng nh·∫≠p
    if (btnAccount) btnAccount.style.display = "inline-block";
    if (userPanel) userPanel.style.display = "none";
    if (btnAdmin) btnAdmin.style.display = "none";
  }

  // ƒêƒÉng xu·∫•t
  if (btnLogout) {
    btnLogout.addEventListener("click", () => {
      localStorage.clear();
      window.location.href = "login.html";
    });
  }
});
</script>





      <!-- Mobile drawer -->
      <nav class="drawer">
        <ul class="drawer-list">
          <li><a href="#">ƒêi·ªán tho·∫°i</a></li>
          <li><a href="#">Laptop</a></li>
          <li><a href="#">Tablet</a></li>
          <li><a href="#">√Çm thanh</a></li>
          <li><a href="#">ƒê·ªìng h·ªì</a></li>
          <li><a href="#">Ph·ª• ki·ªán</a></li>
         
         
        </ul>
      </nav>
    </div>

    <!-- Category bar (desktop) -->
    <div class="category-bar">
      <div class="container cat-inner">
        <a href="showproduct1.html">ƒêi·ªán tho·∫°i</a>
        <a href="showproduct2.html">Laptop</a>
        <a href="showproduct3.html">ƒê·ªìng h·ªì</a>
        <a href="showproduct4.html">Ph·ª• ki·ªán</a>

      </div>
    </div>
  </header>

  <!-- Hero / Banner -->
  <section class="hero">
    <div class="container hero-grid">
      <a class="hero-main" href="#">
        <img src="https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?q=80&w=1600&auto=format&fit=crop" alt="Banner ƒëi·ªán tho·∫°i n·ªïi b·∫≠t">
        <div class="hero-caption">
          <h2>Super Sale Th√°ng 8</h2>
          <p>Gi·∫£m ƒë·∫øn 6 tri·ªáu cho iPhone, Galaxy, Pixel</p>
          <span class="btn">Mua ngay</span>
        </div>
      </a>
      <a class="hero-side" href="#">
        <img src="https://images.unsplash.com/photo-1517336714731-489689fd1ca8?q=80&w=1200&auto=format&fit=crop" alt="Khuy·∫øn m√£i laptop">
        <div class="tile-caption">Laptop H·ªçc t·∫≠p & VƒÉn ph√≤ng</div>
      </a>
      <a class="hero-side" href="#">
        <img src="https://images.unsplash.com/photo-1675317132583-75301c0d0287?q=80&w=1170&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="Khuy·∫øn m√£i ph·ª• ki·ªán">
        <div class="tile-caption">Ph·ª• ki·ªán ƒë·ªìng gi√° 99k</div>
      </a>
    </div>
  </section>

  <!-- Promo Strips -->
  <section class="promo">
    <div class="container promo-grid">
      <a class="promo-card" href="#">
        <div class="promo-emoji">üí≥</div>
        <div class="promo-text">
          <h3>Mi·ªÖn ph√≠ giao h√†ng</h3>
          <p>Giao h√†ng nhanh ch√≥ng</p>
        </div>
      </a>
      <a class="promo-card" href="#">
        <div class="promo-emoji">üöö</div>
        <div class="promo-text">
          <h3>Giao nhanh 2h</h3>
          <p>N·ªôi th√†nh nhi·ªÅu t·ªânh th√†nh</p>
        </div>
      </a>
      <a class="promo-card" href="#">
        <div class="promo-emoji">üîÑ</div>
        <div class="promo-text">
          <h3>ƒê·ªïi tr·∫£ 30 ng√†y</h3>
          <p>An t√¢m mua s·∫Øm</p>
        </div>
      </a>
      <a class="promo-card" href="#">
        <div class="promo-emoji">üéÅ</div>
        <div class="promo-text">
          <h3>Qu√† t·∫∑ng h·∫•p d·∫´n</h3>
          <p>T·ªïng qu√† ƒë·∫øn 2 tri·ªáu</p>
        </div>
      </a>
    </div>
  </section>

  <!-- Product Section: Phones -->
  <section class="section">
    <div class="container section-head">
      <h2>ƒêi·ªán tho·∫°i n·ªïi b·∫≠t</h2>
      <div class="tabs">
        <a href="#" class="tab active">T·∫•t c·∫£</a>
        <a href="#" class="tab">iPhone</a>
        <a href="#" class="tab">Samsung</a>
        <a href="#" class="tab">Xiaomi</a>
        <a href="#" class="tab">Realme</a>
      </div>
    </div>
    

   <!-- Product Section: ƒêi·ªán tho·∫°i -->
   <section class="section">
    <div class="container section-head">
      <h2>ƒêi·ªán tho·∫°i khuy·∫øn m√£i</h2>
      <a class="view-all" href="#">Xem t·∫•t c·∫£ ‚Üí</a>
    </div>
    <div id="phone-grid" class="container product-grid">
      <!-- S·∫£n ph·∫©m ƒëi·ªán tho·∫°i s·∫Ω render t·ª´ JS -->
    </div>
  </section>
  
  <!-- Product Section: Laptops -->
  <section class="section">
    <div class="container section-head">
      <h2>Laptop khuy·∫øn m√£i</h2>
      <a class="view-all" href="#">Xem t·∫•t c·∫£ ‚Üí</a>
    </div>
    <div id="laptop-grid" class="container product-grid">
      <!-- S·∫£n ph·∫©m laptop s·∫Ω render t·ª´ JS -->
    </div>
  </section>
  
  <!-- Product Section: Tablet -->
  <section class="section">
    <div class="container section-head">
      <h2>Tablet khuy·∫øn m√£i</h2>
      <a class="view-all" href="#">Xem t·∫•t c·∫£ ‚Üí</a>
    </div>
    <div id="tablet-grid" class="container product-grid"></div>
  </section>
  
  <!-- Product Section: Ph·ª• ki·ªán ƒëi·ªán tho·∫°i -->
  <section class="section">
    <div class="container section-head">
      <h2>Ph·ª• ki·ªán ƒëi·ªán tho·∫°i</h2>
      <a class="view-all" href="#">Xem t·∫•t c·∫£ ‚Üí</a>
    </div>
    <div id="phone-accessory-grid" class="container product-grid"></div>
  </section>
  
  <!-- Product Section: Ph·ª• ki·ªán laptop -->
  <section class="section">
    <div class="container section-head">
      <h2>Ph·ª• ki·ªán laptop</h2>
      <a class="view-all" href="#">Xem t·∫•t c·∫£ ‚Üí</a>
    </div>
    <div id="laptop-accessory-grid" class="container product-grid"></div>
  </section>
  
  <!-- Product Section: √Çm thanh -->
  <section class="section">
    <div class="container section-head">
      <h2>√Çm thanh</h2>
      <a class="view-all" href="#">Xem t·∫•t c·∫£ ‚Üí</a>
    </div>
    <div id="audio-grid" class="container product-grid"></div>
  </section>
  
  <!-- Product Section: ƒê·ªìng h·ªì -->
  <section class="section">
    <div class="container section-head">
      <h2>ƒê·ªìng h·ªì th√¥ng minh</h2>
      <a class="view-all" href="#">Xem t·∫•t c·∫£ ‚Üí</a>
    </div>
    <div id="watch-grid" class="container product-grid"></div>
  </section>
  <script>
    
    // H√†m fetch s·∫£n ph·∫©m
    async function fetchProducts(categoryId, containerId, limit = 6) {
      try {
        const res = await fetch(`${API_BASE}/products?category_id=${categoryId}&limit=${limit}`);
        const data = await res.json();
    
        if (!data.success) {
          document.getElementById(containerId).innerHTML = `<p>${data.message}</p>`;
          return;
        }
    
        renderProducts(data.data, containerId);
      } catch (err) {
        console.error("Fetch error:", err);
        document.getElementById(containerId).innerHTML = `<p>L·ªói t·∫£i s·∫£n ph·∫©m!</p>`;
      }
    }
    
    // H√†m render s·∫£n ph·∫©m
    function renderProducts(products, containerId) {
      const grid = document.getElementById(containerId);
      grid.innerHTML = "";
    
      products.forEach(prod => {
        const card = document.createElement("div");
        card.className = "product-card";
    
        // ·∫¢nh
        let thumb = Array.isArray(prod.thumbnail) ? prod.thumbnail[0] : prod.thumbnail;
        const pid = prod.product_id || prod.id;

        // Accept absolute URLs directly
        let imgUrl = "";
        if (thumb) {
          if (/^https?:\/\//i.test(thumb)) {
            // Already full URL from API
            imgUrl = thumb;
          } else if (thumb.startsWith("/api/")) {
            // Relative API path
            imgUrl = `http://localhost/ecommerce_api/index.php${thumb}`;
          } else {
            // Filename only - use API route
            imgUrl = `http://localhost/ecommerce_api/index.php/api/images/products/${pid}/${thumb}`;
          }
        } else {
          imgUrl = ""; // No hardcode fallback
        }

        const img = document.createElement("img");
        img.src = imgUrl || createPlaceholderImage();
        img.onerror = () => { 
          img.onerror = null; 
          img.src = createPlaceholderImage(); 
        };
        img.alt = prod.product_name || "";
        img.style.width = "150px";
        card.appendChild(img);
    
        // T√™n
        const h3 = document.createElement("h3");
        h3.className = "product-name";
        h3.textContent = prod.product_name;
        card.appendChild(h3);
    
        // Gi√°
        const priceDiv = document.createElement("div");
        priceDiv.className = "price";
        const strong = document.createElement("strong");
        strong.textContent = Number(prod.price || 0).toLocaleString("vi-VN") + "‚Ç´";
        priceDiv.appendChild(strong);
        if (prod.old_price && prod.old_price > prod.price) {
          const s = document.createElement("s");
          s.textContent = Number(prod.old_price).toLocaleString("vi-VN") + "‚Ç´";
          priceDiv.appendChild(s);
        }
        card.appendChild(priceDiv);
    
        // Actions
        const actions = document.createElement("div");
        actions.className = "actions";
    
        // N√∫t Mua ngay
        const buyBtn = document.createElement("button");
        buyBtn.className = "btn btn-primary";
        buyBtn.textContent = "Mua ngay";
        buyBtn.addEventListener("click", (e) => {
          e.stopPropagation();
          window.location.href = `product.html?id=${prod.id}`;
        });
    
        // N√∫t Th√™m gi·ªè
        const addBtn = document.createElement("button");
        addBtn.className = "btn btn-outline";
        addBtn.textContent = "Th√™m gi·ªè";
        addBtn.addEventListener("click", async (e) => {
          e.stopPropagation();
    
          const token = localStorage.getItem("token");
          if (!token) {
            alert("B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p ƒë·ªÉ th√™m v√†o gi·ªè h√†ng!");
            window.location.href = "login.html";
            return;
          }
    
          try {
            const res = await fetch(`${API_BASE}/cart`, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                "Authorization": "Bearer " + token
              },
              body: JSON.stringify({
                product_id: prod.id,
                quantity: 1
              })
            });
    
            const data = await res.json();
            if (data.success) {
              alert("‚úÖ ƒê√£ th√™m s·∫£n ph·∫©m v√†o gi·ªè h√†ng!");
            } else {
              alert("‚ùå L·ªói: " + data.message);
            }
          } catch (err) {
            console.error("L·ªói khi th√™m gi·ªè:", err);
            alert("Kh√¥ng th·ªÉ th√™m v√†o gi·ªè h√†ng!");
          }
        });
    
        actions.appendChild(buyBtn);
        actions.appendChild(addBtn);
        card.appendChild(actions);
    
        grid.appendChild(card);
      });
    }
    
    // Khi trang load ‚Üí g·ªçi API
    document.addEventListener("DOMContentLoaded", () => {
      // Render nhi·ªÅu category
      fetchProducts(1, "phone-grid", 6);       // ƒêi·ªán tho·∫°i
      fetchProducts(2, "laptop-grid", 6);      // Laptop
      fetchProducts(3, "watch-grid", 6);       // ƒê·ªìng h·ªì
      fetchProducts(4, "laptop-accessory-grid", 6); // Ph·ª• ki·ªán laptop
      fetchProducts(5, "tablet-grid", 6);      // Tablet
      fetchProducts(6, "phone-accessory-grid", 6); // Ph·ª• ki·ªán ƒëi·ªán tho·∫°i   
      fetchProducts(7, "audio-grid", 6);       // √Çm thanh

    
      // Load gi·ªè h√†ng n·∫øu c√≥
      if (typeof loadCart === 'function') {
        try { loadCart(); } catch (e) { console.debug('[index] loadCart() failed', e); }
      }
    
      // Checkout
      const checkoutBtn = document.querySelector(".checkout-btn");
      if (checkoutBtn) {
        checkoutBtn.addEventListener("click", async () => {
          try {
            const res = await fetch(`${API_BASE}/orders`, {
              method: "POST",
              headers: {
                "Authorization": "Bearer " + localStorage.getItem("token"),
                "Content-Type": "application/json"
              }
            });
    
            const data = await res.json();
    
            if (data.success === true) {
              const orderId = data.data.order_id;
              const totalPrice = data.data.total_price;
              window.location.href = `payment.html?order_id=${orderId}&price=${totalPrice}`;
            } else {
              alert("Kh√¥ng th·ªÉ t·∫°o ƒë∆°n h√†ng");
            }
          } catch (err) {
            console.error("L·ªói khi t·∫°o ƒë∆°n h√†ng:", err);
            alert("C√≥ l·ªói x·∫£y ra khi checkout");
          }
        });
      }
    });
    </script>
    



  <!-- Footer -->
  <!-- l√†m sau-->
  <footer class="footer">
    <div class="container footer-grid">
      <div>
        <a class="logo footer-logo" href="#"><span class="logo-badge">Tech</span><span class="logo-text">Mall</span></a>
        <p class="muted">¬© 2025 TechMall. T·∫•t c·∫£ c√°c quy·ªÅn ƒë∆∞·ª£c b·∫£o l∆∞u.</p>
        <p class="muted">Hotline: 6969 9696 (Mi·ªÖn ph√≠)</p>
      </div>
      <div>
        <h4>H·ªó tr·ª£ kh√°ch h√†ng</h4>
        <ul class="footer-list">
          <li><a href="policy.html">Trung t√¢m tr·ª£ gi√∫p</a></li>
          <li><a href="policy.html">H∆∞·ªõng d·∫´n mua h√†ng</a></li>
          <li><a href="policy.html">Ch√≠nh s√°ch b·∫£o h√†nh</a></li>
          <li><a href="policy.html">Ch√≠nh s√°ch ƒë·ªïi tr·∫£</a></li>
        </ul>
      </div>
      <div>
        <h4>V·ªÅ TechMall</h4>
        <ul class="footer-list">
          <li><a href="#">Gi·ªõi thi·ªáu</a></li>
          <li><a href="#">Tuy·ªÉn d·ª•ng</a></li>
          <li><a href="#">H·ªá th·ªëng c·ª≠a h√†ng</a></li>
        </ul>
      </div>
      <div>
        <h4>K·∫øt n·ªëi v·ªõi ch√∫ng t√¥i</h4>
        <div class="socials">
          <a href="#" aria-label="Facebook">üåê</a>
          <a href="#" aria-label="YouTube">‚ñ∂Ô∏è</a>
          <a href="#" aria-label="Zalo">üí¨</a>
        </div>
      </div>
    </div>
  </footer>

  <!-- Overlay for mobile drawer -->
  <label class="overlay" for="navCheck" aria-hidden="true"></label>
</body>
</html>
